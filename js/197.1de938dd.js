"use strict";(self["webpackChunkhm_shopping"]=self["webpackChunkhm_shopping"]||[]).push([[197],{8197:function(t,e,s){s.r(e),s.d(e,{default:function(){return C}});var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login"},[e("van-nav-bar",{attrs:{title:"会员登录","left-arrow":""},on:{"click-left":function(e){return t.$router.go(-1)}}}),e("div",{staticClass:"container"},[t._m(0),e("div",{staticClass:"from"},[e("div",{staticClass:"from-item"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.Phone,expression:"Phone"}],staticClass:"inp",attrs:{type:"text",maxlength:"11",placeholder:"请输入手机号"},domProps:{value:t.Phone},on:{input:function(e){e.target.composing||(t.Phone=e.target.value)}}})]),e("div",{staticClass:"from-item"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.PicCode,expression:"PicCode"}],staticClass:"inp",attrs:{type:"text",maxlength:"4",placeholder:"输入条形验证码"},domProps:{value:t.PicCode},on:{input:function(e){e.target.composing||(t.PicCode=e.target.value)}}}),t.PicUrl?e("img",{attrs:{src:t.PicUrl,alt:""},on:{click:function(e){return t.GetPicCode()}}}):t._e()]),e("div",{staticClass:"from-item"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.SmsCode,expression:"SmsCode"}],staticClass:"inp",attrs:{type:"text",placeholder:"请输入短信验证码",maxlength:"6"},domProps:{value:t.SmsCode},on:{input:function(e){e.target.composing||(t.SmsCode=e.target.value)}}}),e("button",{on:{click:t.getCode}},[t._v(t._s(t.Second===t.TotalSecond?"获取验证码":t.Second+"秒后重新发送"))])])]),e("div",{staticClass:"login-btn",on:{click:t.login}},[t._v("登录")])])],1)},o=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"title"},[e("h3",[t._v("手机号登录")]),e("p",[t._v("未注册的手机号自动注册")])])}],a=s(5720);const n=()=>a.A.get("/captcha/image"),c=(t,e,s)=>a.A.post("/captcha/sendSmsCaptcha",{form:{captchaCode:t,captchaKey:e,mobile:s}}),r=(t,e)=>a.A.post("/passport/login",{form:{isParty:!1,mobile:t,partyData:{},smsCode:e}});var l=s(1981),d=s(6579),h=s(3518),u={name:"LoginIndex",async created(){if(this.$store.getters.token){const t=this.$route.query.backUrl||"/";this.$router.replace(t)}this.GetPicCode()},data(){return{PicKey:"",PicUrl:"",TotalSecond:60,Second:60,timeout:null,Phone:"",PicCode:"",SmsCode:""}},methods:{...(0,h.PY)("user",["setUserInfo"]),async GetPicCode(){const{data:{base64:t,key:e}}=await n();this.PicUrl=t,this.PicKey=e},vaild(){return/^1[0-9]\d{9}$/.test(this.Phone)?!!/^\w{4}$/.test(this.PicCode)||((0,l.A)("请输入正确验证码"),!1):((0,l.A)("请输入正确手机号"),!1)},async getCode(){if(!this.vaild())return;const t=await c(this.PicCode,this.PicKey,this.Phone);(0,l.A)("验证码发送成功"),(0,d.A)({message:t.message,confirmButtonColor:"#cea26a"}).then((()=>{})),this.timeout||this.Second!==this.TotalSecond||(this.timeout=setInterval((()=>{this.Second--,this.Second<=0&&(clearInterval(this.timeout),this.timeout=null,this.Second=this.TotalSecond)}),1e3))},async login(){if(!this.vaild())return;if(!/^\d{6}$/.test(this.SmsCode))return(0,l.A)("请输入正确验证码");const t=await r(this.Phone,this.SmsCode);(0,l.A)("登录成功"),this.setUserInfo(t.data);const e=this.$route.query.backUrl||"/";this.$router.replace(e)}},destroyed(){clearInterval(this.timeout)}},m=u,p=s(1656),v=(0,p.A)(m,i,o,!1,null,"36bf58c7",null),C=v.exports}}]);
//# sourceMappingURL=197.1de938dd.js.map